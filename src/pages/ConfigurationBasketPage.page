<apex:page standardController="cscfga__Product_Basket__c" extensions="cscfga.ProductBasketAngController">
    <apex:stylesheet value="{!$Resource.cscfga__BundleDetail_css}"/>
    <cscfga:FixUIStyles />
    <cscfga:EmbedAngular />
    <apex:includeScript value="{!$Resource.cscfga__cs_core}" />

    <apex:pageMessages />

    <div ng-app="BasketApp">

        <apex:detail relatedList="true" />

        <apex:pageBlock title="{!$Label.cscfga__confbundet_configured_products}" html-ng-controller="BasketCtrl" html-ng-keydown="key($event, true)"  html-ng-keyup="key($event, false)">

            <apex:pageBlockButtons location="top">
                <input value=" {!$Label.cscfga__cscfga__confbundet_New_Product_Configuration} " class="btn" title="{!$Label.cscfga__cscfga__confbundet_New_Product_Configuration}" name="new_config" type="button" ng-click="newConfig()" />
                <input value=" {!$Label.cscfga__cscfga__confbundet_delete_selected} " class="btn" title="{!$Label.cscfga__cscfga__confbundet_delete_selected}" name="delete_selection" type="button" ng-click="deleteConfigs(getSelection())" />
            </apex:pageBlockButtons>

            <div ng-include="'{!URLFOR($Resource.AngularComponents, 'weakassoc/basket/basket.html')}'"></div>
        </apex:pageBlock>
    </div>

    <script type="text/javascript">
        angular.module("BasketData", []).config(["$provide", function($provide) {
            $provide.value("BasketData", {
                basket: {!basketJson},
                config: {
                    "showListPriceAndDiscountAmount": {!showListPriceAndDiscountAmount},
                    "showRateLineItemsInSeparateColumn": {!showRateLineItemsInSeparateColumn},
                    "displayRecurringInvoiceColumn": {!displayRecurringInvoiceColumn},
                    "displayTCVColumn": {!displayTCVColumn}
                },
                labels: {
                    "action": "{!JSENCODE($Label.cscfga__confbundet_Action)}",
                    "status": "{!JSENCODE($Label.cscfga__confbundet_Status)}",
                    "item": "{!JSENCODE($Label.cscfga__confbundet_Item)}",
                    "quantity": "{!JSENCODE($Label.cscfga__confbundet_Quantity)}",
                    "rate": "{!JSENCODE($Label.cscfga__confbundet_Rate)}",
                    "non-recurring": "{!JSENCODE($Label.cscfga__Non_recurring_header)}",
                    "recurring": "{!JSENCODE($Label.cscfga__Recurring_header)}",
                    "recurring-invoice": "{!JSENCODE($Label.cscfga__Recurring_invoice_header)}",
                    "contract-total": "{!JSENCODE($Label.cscfga__Total_contract_value_header)}",
                    "annual-total": "{!JSENCODE($Label.cscfga__Annualised_total_header)}",
                    "list-price": "{!JSENCODE($Label.cscfga__confbundet_ListPrice)}",
                    "sales-price": "{!JSENCODE($Label.cscfga__confbundet_SalesPrice)}",
                    "discount": "{!JSENCODE($Label.cscfga__confbundet_Discount)}",
                    "edit": "{!JSENCODE($Label.cscfga__confbundet_Edit)}",
                    "copy": "{!JSENCODE($Label.cscfga__confbundet_Copy)}",
                    "del": "{!JSENCODE($Label.cscfga__confbundet_Del)}",
                    "totals-for": "{!JSENCODE($Label.cscfga__confbundet_Totals_for)}",
                    "grand-total": "{!JSENCODE($Label.cscfga__confbundet_Grand_Total)}",

                    "delete-dialog-question": "{!JSENCODE($Label.cscfga__basksumm_delete_dialog_question)}",
                    "are-you-sure": "{!JSENCODE($Label.cscfga__basksumm_delete_sure)}",
                    "starting-delete-batch": "{!JSENCODE($Label.cscfga__basksumm_starting_delete_batch)}",
                    "delete-batch-id": "{!JSENCODE($Label.cscfga__basksumm_delete_batch_id)}",
                    "delete-batch-failed": "{!JSENCODE($Label.cscfga__basksumm_delete_batch_failed)}",

                    "copy-dialog-title": "{!JSENCODE($Label.cscfga__basksumm_copy_related)}",
                    "number-of-copies": "{!JSENCODE($Label.cscfga__basksumm_number_of_copies)}",
                    "starting-batch-copy": "{!JSENCODE($Label.cscfga__basksumm_starting_copy_batch)}",
                    "copy-batch-id": "{!JSENCODE($Label.cscfga__basksumm_copy_batch_id)}",
                    "monitor-batch": "{!JSENCODE($Label.cscfga__basksumm_monitor_batch)}",
                    "reload-after-batch": "{!JSENCODE($Label.cscfga__basksumm_reload_after_batch)}",
                    "copy-batch-failed": "{!JSENCODE($Label.cscfga__basksumm_copy_batch_failed)}",

                    "cancel": "{!JSENCODE($Label.cscfga__basksumm_cancel)}",
                    "confirm": "{!JSENCODE($Label.cscfga__basksumm_delete_confirm)}",
                    "copy": "{!JSENCODE($Label.cscfga__basksumm_copy_button)}",
                    "close": "{!JSENCODE($Label.cscfga__basksumm_close)}",
                    "loading": "{!JSENCODE($Label.cscfga__basksumm_loading)}"
                },
                resources: {
                    "progress": "{!$Resource.cscfga__ProgressBar}"
                },
                contents: {!allBasketItemsJson},
                grandTotal: {!grandTotal}
            });
        }]);
    </script>
    <script type="text/javascript">
        angular.module("BasketRemote", []).config(["$provide", function($provide) {
            $provide.value("BasketRemote", {
                packagePrefix: "{!packagePrefix}",
                fetchGroupDataAction: "{!$RemoteAction.ProductBasketAngController.loadAssociationGroup}",
                copyConfigurations: "{!$RemoteAction.ProductBasketAngController.copyConfigurations}",
                deleteConfigurations: "{!$RemoteAction.ProductBasketAngController.deleteConfigurations}",
                selectCategoryPage: "{!JSENCODE(URLFOR($Page.selectproductcategory))}",
                configureProductPage: "{!JSENCODE(URLFOR($Page.ProductConfiguration))}"
            });
        }]);
    </script>

    <script src="{!URLFOR($Resource.AngularComponents, 'common/common.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.AngularComponents, 'weakassoc/basket/basket.js')}" type="text/javascript"></script>
</apex:page>